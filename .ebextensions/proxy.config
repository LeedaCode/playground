{
    "files": {
        "/etc/nginx/conf.d/proxy.conf": {
            "mode": "000644",
            "owner": "root",
            "group": "root",
            "encoding": "plain",
            "content": "# API Upstream\nupstream nodejs {\n    server 127.0.0.1:8081;\n    keepalive 256;\n}\n\n# HTTP Server\nserver {\n    listen 80;\n\n    if ($time_iso8601 ~ \"^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2})\") {\n        set $year $1;\n        set $month $2;\n        set $day $3;\n        set $hour $4;\n    }\n\n    access_log /var/log/nginx/healthd/application.log.$year-$month-$day-$hour healthd;\n    access_log  /var/log/nginx/access.log  main;\n\n    location /api {\n        proxy_pass  http://nodejs;\n        proxy_set_header   Connection \"\";\n        proxy_http_version 1.1;\n        proxy_set_header        Host            $host;\n        proxy_set_header        X-Real-IP       $remote_addr;\n        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n\n    gzip on;\n    gzip_comp_level 4;\n    gzip_types text/html text/plain text/css application/json application/x-javascript application/javascript text/xml application/xml application/xml+rss text/javascript;\n\n    location / {\n        alias /var/app/current/public;\n    }\n}\n"
        }
    },
    "container_commands": {
        "00-remove-default-configs": {
            "command": "rm -f /tmp/deployment/config/#etc#nginx#conf.d#00_elastic_beanstalk_proxy.conf /etc/nginx/conf.d/00_elastic_beanstalk_proxy.conf"
        },
        "01-restart-nginx": {
            "command": "/sbin/service nginx restart"
        }
    }
}
